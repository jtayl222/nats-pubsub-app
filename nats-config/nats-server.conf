# NATS Server Configuration
# For clustered deployment across multiple VMs

# Server identification
server_name: $SERVER_NAME

# Listen ports
port: 4222                    # Client connections
http_port: 8222              # HTTP monitoring endpoint

# Logging
debug: false
trace: false
logtime: true
log_file: "/dev/stdout"      # Log to stdout for Docker

# Cluster configuration for multi-node setup
cluster {
  name: nats-cluster

  # This server's cluster listen address
  listen: 0.0.0.0:6222

  # Routes to other cluster members
  # These should be updated based on deployment
  routes = [
    nats://nats-1:6222
    nats://nats-2:6222
  ]

  # Cluster connection timeout
  connect_retries: 30
}

# JetStream (persistence and streaming)
jetstream {
  store_dir: "/data/jetstream"
  max_mem: 256M
  max_file: 1G
}

# Connection limits
max_connections: 1000
max_control_line: 4096
max_payload: 1048576          # 1MB max message size
max_pending: 67108864         # 64MB pending data per connection
ping_interval: 2m
ping_max: 3

# Write deadline
write_deadline: 10s

# Authentication (optional - disabled for demo)
# authorization {
#   user: nats
#   password: $NATS_PASSWORD
#   timeout: 1
# }

# System account for internal events
system_account: SYS

# Accounts (optional - simplified for demo)
accounts {
  SYS {
    users = [
      { user: "sys", password: "sys" }
    ]
  }
  APP {
    users = [
      { user: "app", password: "app" }
    ]
  }
}

# Default account
no_auth_user: app
